<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>The Human Filter ‚Äî See Through Any Message | Human Layer AI</title>
<meta name="description" content="Paste any message and instantly detect manipulation, scams, guilt-trips, and hidden agendas. Built with legal reasoning and behavioral psychology. No AI API needed.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:ital,wght@0,700;1,400&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --navy:#0f1923;--navy-light:#162333;--navy-lighter:#1d2e42;--navy-card:#12202e;
  --teal:#2dd4a8;--teal-dim:rgba(45,212,168,0.12);--teal-glow:rgba(45,212,168,0.3);
  --gold:#d4a03c;--gold-dim:rgba(212,160,60,0.12);
  --purple:#8b5cf6;--purple-dim:rgba(139,92,246,0.12);
  --red:#ef4444;--red-dim:rgba(239,68,68,0.12);--red-soft:#ff6b6b;
  --orange:#f97316;--orange-dim:rgba(249,115,22,0.12);
  --green:#10b981;--green-dim:rgba(16,185,129,0.12);
  --pink:#ec4899;--pink-dim:rgba(236,72,153,0.12);
  --cyan:#06b6d4;--cyan-dim:rgba(6,182,212,0.12);
  --dark-bg:#0c121c;--white:#fff;--gray:#94a3b8;--gray-light:#b4bec8;
  --font-body:'Inter',system-ui,sans-serif;--font-display:'Playfair Display',Georgia,serif;--font-mono:'JetBrains Mono',monospace;
  --radius:12px;--radius-sm:8px;--radius-lg:16px;
  --transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
}
html{scroll-behavior:smooth}
body{font-family:var(--font-body);background:var(--dark-bg);color:var(--white);line-height:1.6;overflow-x:hidden;-webkit-font-smoothing:antialiased}

/* HEADER */
.header{position:sticky;top:0;z-index:100;padding:12px 20px;background:rgba(12,18,28,0.92);backdrop-filter:blur(16px);border-bottom:1px solid rgba(45,212,168,0.08);display:flex;align-items:center;justify-content:space-between}
.header-brand{display:flex;align-items:center;gap:10px}
.header-brand .logo-text{font-family:var(--font-display);font-size:1.1rem;color:var(--gold)}
.header-brand .logo-sub{font-size:0.7rem;color:var(--gray);letter-spacing:2px;text-transform:uppercase}
.header-links{display:flex;gap:12px;align-items:center}
.header-links a{font-size:0.8rem;color:var(--gray);text-decoration:none;transition:var(--transition)}
.header-links a:hover{color:var(--teal)}
.btn-cta{background:var(--gold);color:var(--navy);font-weight:600;font-size:0.75rem;padding:8px 16px;border-radius:20px;text-decoration:none;letter-spacing:0.5px;transition:var(--transition)}
.btn-cta:hover{filter:brightness(1.15);transform:translateY(-1px)}

/* HERO */
.hero{text-align:center;padding:40px 20px 24px;max-width:680px;margin:0 auto}
.hero-badge{display:inline-block;font-size:0.7rem;letter-spacing:2px;text-transform:uppercase;color:var(--teal);padding:6px 16px;border:1px solid var(--teal-dim);border-radius:20px;margin-bottom:16px}
.hero h1{font-family:var(--font-display);font-size:clamp(1.8rem,5vw,2.8rem);line-height:1.15;margin-bottom:12px}
.hero h1 .accent{color:var(--gold);font-style:italic}
.hero p{color:var(--gray-light);font-size:clamp(0.85rem,2.5vw,1rem);max-width:540px;margin:0 auto 20px}

/* PRESET CHIPS */
.presets{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;padding:0 16px;margin-bottom:24px;max-width:680px;margin-left:auto;margin-right:auto}
.preset-chip{display:inline-flex;align-items:center;gap:6px;font-size:0.75rem;padding:7px 14px;border-radius:20px;border:1px solid var(--navy-lighter);background:var(--navy-light);color:var(--gray-light);cursor:pointer;transition:var(--transition);white-space:nowrap;-webkit-tap-highlight-color:transparent}
.preset-chip:hover,.preset-chip:active{border-color:var(--teal);color:var(--teal);background:var(--teal-dim)}
.preset-chip .chip-icon{font-size:0.85rem}

/* INPUT PANEL */
.input-section{max-width:680px;margin:0 auto;padding:0 16px 20px}
.input-panel{background:var(--navy-card);border:1px solid var(--navy-lighter);border-radius:var(--radius-lg);overflow:hidden}
.input-top{display:flex;justify-content:space-between;align-items:center;padding:14px 16px 10px;border-bottom:1px solid rgba(255,255,255,0.04)}
.input-label{font-size:0.8rem;font-weight:600;letter-spacing:1px;text-transform:uppercase;color:var(--gray)}
.char-count{font-size:0.7rem;color:var(--gray);font-family:var(--font-mono)}
.input-area{width:100%;min-height:140px;max-height:300px;padding:16px;background:transparent;border:none;color:var(--white);font-family:var(--font-body);font-size:0.9rem;line-height:1.65;resize:vertical;outline:none}
.input-area::placeholder{color:rgba(148,163,184,0.4);font-style:italic}
.input-bottom{padding:12px 16px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;border-top:1px solid rgba(255,255,255,0.04)}
.try-label{font-size:0.7rem;color:var(--gray);font-weight:500}
.try-chip{font-size:0.7rem;padding:5px 10px;border-radius:12px;border:1px solid var(--navy-lighter);background:transparent;color:var(--teal);cursor:pointer;transition:var(--transition)}
.try-chip:hover{background:var(--teal-dim);border-color:var(--teal)}
.try-chip.active{background:var(--teal);color:var(--navy);border-color:var(--teal)}

/* DECODE BUTTON */
.decode-btn{display:block;width:calc(100% - 32px);max-width:648px;margin:0 auto 20px;padding:14px;font-size:0.95rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--navy);background:linear-gradient(135deg,var(--gold),#e8b84a);border:none;border-radius:var(--radius);cursor:pointer;transition:var(--transition);-webkit-tap-highlight-color:transparent}
.decode-btn:hover{filter:brightness(1.1);transform:translateY(-1px);box-shadow:0 4px 20px rgba(212,160,60,0.3)}
.decode-btn:active{transform:translateY(0)}
.decode-btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}

/* SCAN OVERLAY */
.scan-overlay{position:fixed;inset:0;z-index:999;background:rgba(12,18,28,0.95);display:none;align-items:center;justify-content:center;flex-direction:column;gap:20px}
.scan-overlay.active{display:flex}
.scan-spinner{width:48px;height:48px;border:3px solid var(--navy-lighter);border-top-color:var(--teal);border-radius:50%;animation:spin 0.8s linear infinite}
.scan-text{color:var(--teal);font-size:0.85rem;letter-spacing:1px;animation:pulse 1.5s ease infinite}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}

/* === RESULTS === */
.results-section{display:none;max-width:680px;margin:0 auto;padding:0 16px 40px}
.results-section.visible{display:block;animation:fadeUp 0.5s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

/* VERDICT BANNER */
.verdict-banner{border-radius:var(--radius-lg);padding:20px;margin-bottom:16px;text-align:center;position:relative;overflow:hidden}
.verdict-banner::before{content:'';position:absolute;inset:0;opacity:0.06}
.verdict-banner.scam{background:linear-gradient(135deg,rgba(239,68,68,0.15),rgba(239,68,68,0.05));border:2px solid var(--red)}
.verdict-banner.scam::before{background:var(--red)}
.verdict-banner.manipulation{background:linear-gradient(135deg,rgba(249,115,22,0.15),rgba(249,115,22,0.05));border:2px solid var(--orange)}
.verdict-banner.manipulation::before{background:var(--orange)}
.verdict-banner.caution{background:linear-gradient(135deg,rgba(212,160,60,0.15),rgba(212,160,60,0.05));border:2px solid var(--gold)}
.verdict-banner.caution::before{background:var(--gold)}
.verdict-banner.clean{background:linear-gradient(135deg,rgba(16,185,129,0.15),rgba(16,185,129,0.05));border:2px solid var(--green)}
.verdict-banner.clean::before{background:var(--green)}
.verdict-icon{font-size:2rem;margin-bottom:6px}
.verdict-label{font-size:1.2rem;font-weight:700;letter-spacing:1px;text-transform:uppercase;margin-bottom:4px}
.verdict-sub{font-size:0.8rem;color:var(--gray-light)}
.verdict-banner.scam .verdict-label{color:var(--red)}
.verdict-banner.manipulation .verdict-label{color:var(--orange)}
.verdict-banner.caution .verdict-label{color:var(--gold)}
.verdict-banner.clean .verdict-label{color:var(--green)}

/* AGENDA CARD */
.agenda-card{background:var(--navy-card);border:1px solid var(--navy-lighter);border-radius:var(--radius-lg);padding:18px;margin-bottom:16px}
.agenda-header{font-size:0.75rem;letter-spacing:1.5px;text-transform:uppercase;color:var(--gray);margin-bottom:10px;display:flex;align-items:center;gap:8px}
.agenda-goal{font-size:1rem;font-weight:600;color:var(--gold);margin-bottom:8px;line-height:1.4}
.agenda-tactics{display:flex;flex-wrap:wrap;gap:6px;margin-top:10px}
.agenda-tactic{font-size:0.7rem;padding:4px 10px;border-radius:12px;background:var(--orange-dim,rgba(249,115,22,0.12));color:var(--orange);border:1px solid rgba(249,115,22,0.2)}

/* DECODED MEANING (GREEN SECTION) */
.meaning-card{background:linear-gradient(135deg,rgba(16,185,129,0.08),rgba(16,185,129,0.02));border:1px solid rgba(16,185,129,0.25);border-radius:var(--radius-lg);padding:18px;margin-bottom:16px}
.meaning-header{font-size:0.75rem;letter-spacing:1.5px;text-transform:uppercase;color:var(--green);margin-bottom:10px;display:flex;align-items:center;gap:8px}
.meaning-text{font-size:0.9rem;line-height:1.7;color:var(--green);font-family:var(--font-mono);white-space:pre-wrap}

/* SCORE RING */
.score-row{display:flex;gap:16px;margin-bottom:16px;flex-wrap:wrap}
.score-card{flex:1;min-width:140px;background:var(--navy-card);border:1px solid var(--navy-lighter);border-radius:var(--radius-lg);padding:18px;text-align:center}
.score-ring-wrap{position:relative;width:80px;height:80px;margin:0 auto 10px}
.score-ring-wrap svg{width:80px;height:80px;transform:rotate(-90deg)}
.score-ring-wrap .ring-bg{fill:none;stroke:var(--navy-lighter);stroke-width:6}
.score-ring-wrap .ring-fill{fill:none;stroke-width:6;stroke-linecap:round;transition:stroke-dashoffset 1s ease}
.score-number{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:1.4rem;font-weight:700}
.score-label{font-size:0.7rem;color:var(--gray);letter-spacing:1px;text-transform:uppercase}
.sub-scores{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:10px}
.sub-score{display:flex;align-items:center;gap:6px;font-size:0.7rem;padding:4px 10px;border-radius:12px;background:var(--navy-light);color:var(--gray-light)}
.sub-dot{width:6px;height:6px;border-radius:50%}

/* FINDINGS TABS */
.findings-panel{background:var(--navy-card);border:1px solid var(--navy-lighter);border-radius:var(--radius-lg);overflow:hidden;margin-bottom:16px}
.findings-tabs{display:flex;overflow-x:auto;border-bottom:1px solid var(--navy-lighter);-webkit-overflow-scrolling:touch;scrollbar-width:none}
.findings-tabs::-webkit-scrollbar{display:none}
.findings-tab{flex:none;padding:10px 16px;font-size:0.72rem;font-weight:600;letter-spacing:0.5px;text-transform:uppercase;color:var(--gray);cursor:pointer;border-bottom:2px solid transparent;transition:var(--transition);white-space:nowrap;-webkit-tap-highlight-color:transparent}
.findings-tab:hover{color:var(--white)}
.findings-tab.active{color:var(--teal);border-bottom-color:var(--teal)}
.findings-tab .tab-count{display:inline-flex;align-items:center;justify-content:center;min-width:18px;height:18px;font-size:0.6rem;padding:0 5px;border-radius:9px;background:var(--navy-lighter);color:var(--gray);margin-left:5px}
.findings-tab.active .tab-count{background:var(--teal-dim);color:var(--teal)}
.findings-content{padding:16px}
.finding-card{background:var(--navy-light);border:1px solid var(--navy-lighter);border-radius:var(--radius);padding:14px;margin-bottom:12px}
.finding-card:last-child{margin-bottom:0}
.finding-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:6px}
.finding-name{font-size:0.85rem;font-weight:600}
.finding-badge{font-size:0.6rem;font-weight:700;letter-spacing:0.5px;padding:3px 8px;border-radius:8px;text-transform:uppercase}
.finding-badge.high{background:var(--red-dim);color:var(--red-soft)}
.finding-badge.medium{background:var(--orange-dim);color:var(--orange)}
.finding-badge.low{background:var(--teal-dim);color:var(--teal)}
.finding-type{font-size:0.65rem;color:var(--gray);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.finding-desc{font-size:0.8rem;color:var(--gray-light);line-height:1.5;margin-bottom:10px}
.finding-quote{font-family:var(--font-mono);font-size:0.75rem;padding:10px;border-left:3px solid var(--teal);background:rgba(45,212,168,0.05);border-radius:0 var(--radius-sm) var(--radius-sm) 0;color:var(--teal);margin-bottom:8px;line-height:1.5}
.finding-action{font-size:0.75rem;color:var(--gold);display:flex;align-items:flex-start;gap:6px}
.finding-action::before{content:'‚Üí';flex-shrink:0}

/* FOOTER */
.footer{text-align:center;padding:32px 16px;border-top:1px solid var(--navy-lighter);margin-top:20px}
.footer p{font-size:0.75rem;color:var(--gray)}
.footer a{color:var(--gold);text-decoration:none}
.footer a:hover{text-decoration:underline}

/* COPY BUTTON */
.copy-btn{display:flex;align-items:center;gap:6px;margin:0 auto;padding:10px 24px;font-size:0.8rem;font-weight:600;color:var(--teal);background:var(--teal-dim);border:1px solid rgba(45,212,168,0.2);border-radius:var(--radius);cursor:pointer;transition:var(--transition)}
.copy-btn:hover{background:rgba(45,212,168,0.2)}

/* MOBILE */
@media(max-width:480px){
  .header{padding:10px 14px}
  .header-links a:not(.btn-cta){display:none}
  .hero{padding:28px 16px 16px}
  .hero h1{font-size:1.6rem}
  .presets{gap:6px;padding:0 12px}
  .preset-chip{font-size:0.68rem;padding:6px 10px}
  .input-section{padding:0 12px 16px}
  .input-area{min-height:120px;font-size:0.85rem;padding:12px}
  .decode-btn{width:calc(100% - 24px);font-size:0.85rem;padding:12px}
  .results-section{padding:0 12px 32px}
  .verdict-banner{padding:16px}
  .score-row{flex-direction:column}
  .findings-tab{padding:8px 12px;font-size:0.68rem}
  .finding-card{padding:12px}
}
</style>
</head>
<body>

<!-- HEADER -->
<header class="header">
  <div class="header-brand">
    <div>
      <div class="logo-text">Human Layer AI</div>
      <div class="logo-sub">The Human Filter</div>
    </div>
  </div>
  <div class="header-links">
    <a href="https://aakarshsharma.com">Portfolio</a>
    <a href="https://aakarshsharma.com/artifacts">Artifacts</a>
    <a href="https://calendly.com" class="btn-cta">Book a Call</a>
  </div>
</header>

<!-- HERO -->
<section class="hero">
  <div class="hero-badge">‚óè The Human Filter</div>
  <h1>What Are They <span class="accent">Really</span> Saying?</h1>
  <p>Paste any message ‚Äî a suspicious DM, a too-good-to-be-true offer, a guilt-trip text ‚Äî and see the manipulation tactics, hidden agendas, and scam patterns the sender doesn't want you to notice.</p>
</section>

<!-- PRESET CHIPS -->
<div class="presets" id="presets">
  <div class="preset-chip" data-preset="dating"><span class="chip-icon">üíò</span>Dating App Msg</div>
  <div class="preset-chip" data-preset="scam"><span class="chip-icon">üö®</span>Scam Email</div>
  <div class="preset-chip" data-preset="guilt"><span class="chip-icon">üò¢</span>Guilt-Trip Text</div>
  <div class="preset-chip" data-preset="workfavor"><span class="chip-icon">ü§ù</span>Work Favor</div>
  <div class="preset-chip" data-preset="mlm"><span class="chip-icon">üíé</span>MLM Pitch</div>
  <div class="preset-chip" data-preset="fakejob"><span class="chip-icon">üíº</span>Fake Job Offer</div>
  <div class="preset-chip" data-preset="phishing"><span class="chip-icon">üîó</span>Phishing Link</div>
  <div class="preset-chip" data-preset="landlord"><span class="chip-icon">üè†</span>Landlord Msg</div>
  <div class="preset-chip" data-preset="sales"><span class="chip-icon">üìß</span>Sales Email</div>
  <div class="preset-chip" data-preset="linkedin"><span class="chip-icon">üí¨</span>LinkedIn DM</div>
  <div class="preset-chip" data-preset="contract"><span class="chip-icon">üìú</span>Contract Clause</div>
  <div class="preset-chip" data-preset="catfish"><span class="chip-icon">üê±</span>Catfishing DM</div>
</div>

<!-- INPUT -->
<section class="input-section">
  <div class="input-panel">
    <div class="input-top">
      <span class="input-label">Paste the message</span>
      <span class="char-count" id="charCount">0 chars</span>
    </div>
    <textarea class="input-area" id="inputText" placeholder="Paste any text here ‚Äî a WhatsApp message, a DM, an email, a job listing, a contract, or anything you want to see through..."></textarea>
    <div class="input-bottom">
      <span class="try-label">Quick try:</span>
      <button class="try-chip" data-demo="sales">Sales Email</button>
      <button class="try-chip" data-demo="scam">Advance-Fee Scam</button>
      <button class="try-chip" data-demo="dating">Dating Msg</button>
      <button class="try-chip" data-demo="guilt">Guilt-Trip</button>
      <button class="try-chip" data-demo="mlm">MLM Pitch</button>
    </div>
  </div>
</section>

<!-- DECODE BUTTON -->
<button class="decode-btn" id="decodeBtn" onclick="runAnalysis()">Filter This Message</button>

<!-- SCAN OVERLAY -->
<div class="scan-overlay" id="scanOverlay">
  <div class="scan-spinner"></div>
  <div class="scan-text">Running through the Human Filter...</div>
</div>

<!-- RESULTS -->
<section class="results-section" id="resultsSection">
  <!-- Verdict Banner -->
  <div class="verdict-banner" id="verdictBanner">
    <div class="verdict-icon" id="verdictIcon"></div>
    <div class="verdict-label" id="verdictLabel"></div>
    <div class="verdict-sub" id="verdictSub"></div>
  </div>

  <!-- Likely Agenda -->
  <div class="agenda-card" id="agendaCard">
    <div class="agenda-header">üéØ Likely Agenda</div>
    <div class="agenda-goal" id="agendaGoal"></div>
    <div class="agenda-tactics" id="agendaTactics"></div>
  </div>

  <!-- What They Actually Mean (GREEN) -->
  <div class="meaning-card" id="meaningCard">
    <div class="meaning-header">üß† What They're Actually Saying</div>
    <div class="meaning-text" id="meaningText"></div>
  </div>

  <!-- Score Row -->
  <div class="score-row">
    <div class="score-card">
      <div class="score-ring-wrap">
        <svg viewBox="0 0 36 36"><circle class="ring-bg" cx="18" cy="18" r="14"/><circle class="ring-fill" id="dangerRing" cx="18" cy="18" r="14" stroke-dasharray="88" stroke-dashoffset="88"/></svg>
        <div class="score-number" id="dangerNum">0</div>
      </div>
      <div class="score-label">Danger Level</div>
    </div>
    <div class="score-card">
      <div class="sub-scores" id="subScores"></div>
      <div class="score-label" style="margin-top:8px">Breakdown</div>
    </div>
  </div>

  <!-- Findings -->
  <div class="findings-panel">
    <div class="findings-tabs" id="findingsTabs"></div>
    <div class="findings-content" id="findingsContent"></div>
  </div>

  <!-- Copy -->
  <button class="copy-btn" onclick="copyResults()">üìã Copy Full Analysis</button>
</section>

<!-- FOOTER -->
<footer class="footer">
  <p>Built by <a href="https://aakarshsharma.com">Aakarsh Sharma</a> ¬∑ Law √ó Psychology √ó AI ¬∑ <a href="https://aakarshsharma.com/artifacts">More Artifacts</a></p>
  <p style="margin-top:6px;font-size:0.65rem;color:var(--gray)">The Human Filter runs entirely in your browser. No data leaves your device.</p>
</footer>

<script>
// =========================================================
// THE HUMAN FILTER ‚Äî Analysis Engine v2
// Built by Aakarsh Sharma | Human Layer AI
// Law √ó Psychology √ó AI
// =========================================================

// --- PRESET SAMPLE TEXTS ---
const PRESETS = {
  dating: `Hey gorgeous üòç I know we just matched but I feel like I already know you. You're not like other girls on here ‚Äî you actually seem real. I deleted the app btw, you're the only one I'm talking to. Can I get your number? I hate texting on here. Also my premium is expiring soon so we might lose this connection üòÖ`,

  scam: `Dear Beloved,\n\nI am Mrs. Margaret Patton, a widow of late Mr. Richard Patton who was a renowned oil magnate. Before my husband died, he deposited the sum of $12.5 Million USD in a Finance House. I am contacting you because I need a trustworthy foreign partner to receive these funds on my behalf due to political instability in my country.\n\nYou will receive 30% of the total amount for your assistance. All I need is your full name, bank details, and a small processing fee of $450 to initiate the transfer. Please respond urgently as time is of the essence.\n\nGod bless you,\nMrs. Margaret Patton`,

  guilt: `I guess I'm just not important enough for you to make time for me anymore. Remember when you used to call me every day? I sat by the phone all evening waiting. But it's fine, I'm used to being disappointed. Your father was the same way. Don't worry about me, I'll manage somehow. I always do. I just hope you don't regret this when I'm gone.`,

  workfavor: `Hey! So I have a HUGE favor to ask and you're literally the only person who can help. I know you're swamped but this would only take "a few minutes" of your time. Remember when I covered for you during that meeting last month? Also, Sarah from leadership specifically mentioned your name for this. It would really look bad if we dropped the ball on this one. Can you take this on by EOD? I already told the client you'd handle it üòä`,

  mlm: `Hey girl!! üíï So I know we haven't talked since high school but I've been DYING to reach out! You've been looking AMAZING on Instagram lately! üî• So I recently started my own business (finally being my own boss! üôå) and I immediately thought of YOU. I'm looking for just 3 more people to join my team this month. The starter kit is only $299 and most people make that back in their first week!! You'd be SO perfect for this. Can I send you more info? This opportunity literally changed my life! üöÄüí∞`,

  fakejob: `Congratulations! You've been selected for a Remote Data Entry Specialist position at GlobalTech Solutions. Salary: $75-95/hr, work from home, flexible hours. No experience needed ‚Äî we provide full training!\n\nTo secure your position, please complete the following:\n1. Purchase a home office setup kit ($199, reimbursed on first paycheck)\n2. Send your SSN and bank details for payroll setup\n3. Download our proprietary software from the link below\n\nThis offer expires in 24 hours. Reply ASAP to confirm your spot ‚Äî only 3 positions remaining!`,

  phishing: `‚ö†Ô∏è URGENT: Your Apple ID has been compromised! Unusual sign-in detected from Moscow, Russia at 3:47 AM.\n\nIf this wasn't you, your account will be permanently locked in 12 hours.\n\n‚Üí Click here to verify your identity: apple-id-secure-verify.com/restore\n\nDo NOT ignore this message. Failure to verify within 12 hours will result in permanent data loss and account termination.\n\nApple Security Team\nRef: #INC-2026-88431`,

  landlord: `Hi tenant. Just wanted to give you a heads up that rent is going up $400/month starting next month. Market rates have gone up significantly. Also I'll need to come by this weekend to "inspect" the unit ‚Äî no need to be home, I have a key. If you have a problem with the new rate, you're welcome to find somewhere else. I have a waiting list of people who'd love your unit. Let me know by Friday or I'll assume you agree.`,

  sales: `Hi [Name],\n\nI wanted to reach out personally because we've been watching your company's growth closely, and frankly, we're impressed. Companies like yours that are scaling this fast typically hit a critical infrastructure bottleneck within 6-9 months ‚Äî and by then, it's already too expensive to fix.\n\nWe've helped 247 companies in your space avoid exactly this problem, including [Well-Known Competitor] and [Industry Leader], who both saw 340% ROI within the first quarter.\n\nI know you're busy, so I'll be direct: we've reserved a spot for your team in our next cohort, but it closes Friday. Want me to hold it?\n\nBest,\nJake`,

  linkedin: `Hi! I came across your profile and I'm really impressed by your background. We're building something revolutionary in the AI space and your skillset is exactly what we need. I can't share too many details publicly but this is backed by a top-tier VC firm. We're pre-revenue but growing 400% MoM. The equity package alone could be worth 7 figures in 2 years. Would love to hop on a quick 15-min call this week. When works for you?`,

  contract: `The Contractor agrees to assign all intellectual property rights, including but not limited to patents, copyrights, trade secrets, and moral rights, for any work product created during or tangentially related to the engagement period, in perpetuity, throughout the universe. The Contractor waives any right to attribution. Non-compete period: 36 months post-termination within any industry the Company operates or plans to operate in. Disputes shall be resolved via binding arbitration in a jurisdiction of the Company's choosing, with costs borne by the Contractor.`,

  catfish: `Baby I miss you so much ü•∫ I know we haven't video called yet but my camera is broken and I'm saving up for a new phone. You're the best thing that's ever happened to me. I've never felt this way about anyone. Hey so I'm in a really tough spot right now ‚Äî my mom needs surgery and I'm $500 short. I hate asking but you're the only person I trust. I'll pay you back as soon as I get paid next week, I promise. Can you send it through Zelle? I love you üíï`
};

// --- SCAM & FRAUD DETECTION ENGINE ---
const SCAM_PATTERNS = [
  {pattern: /\b(bank\s*details?|bank\s*account|routing\s*number|account\s*number)\b/i, weight: 9, name: 'Requests banking info'},
  {pattern: /\b(ssn|social\s*security|passport\s*number|identity\s*document)\b/i, weight: 10, name: 'Requests identity documents'},
  {pattern: /\b(processing\s*fee|advance\s*fee|small\s*fee|upfront\s*payment|pay.*(?:first|before|to\s*receive))\b/i, weight: 9, name: 'Advance fee request'},
  {pattern: /\b(dear\s*beloved|dear\s*friend|dear\s*one|dear\s*sir\/madam)\b/i, weight: 7, name: '419-style greeting'},
  {pattern: /\$[\d,]+(?:\.\d+)?\s*(?:million|usd|dollars|gbp)/i, weight: 8, name: 'Large sum mentioned'},
  {pattern: /\b(widow|widower|dying|terminally\s*ill|deathbed|late\s*husband|late\s*wife)\b/i, weight: 6, name: 'Sympathy/death narrative'},
  {pattern: /\b(political\s*instability|war.torn|government\s*seizure|confidential\s*matter)\b/i, weight: 7, name: 'Urgency through instability'},
  {pattern: /\b(trustworthy|foreign\s*partner|reliable\s*person|god.fearing)\b/i, weight: 6, name: 'Trust-building language'},
  {pattern: /\b(respond\s*urgently|time\s*is\s*of\s*the\s*essence|act\s*now|expires?\s*(?:in|within|today|soon)|only\s*\d+\s*(?:positions?|spots?|left))\b/i, weight: 7, name: 'Artificial urgency'},
  {pattern: /\b(click\s*here|verify\s*your|confirm\s*your\s*(?:identity|account)|secure.*account)\b/i, weight: 8, name: 'Phishing call-to-action'},
  {pattern: /\b(permanently?\s*(?:locked|deleted|terminated|suspended)|data\s*loss|account\s*(?:locked|suspended|terminated))\b/i, weight: 7, name: 'Fear of loss threat'},
  {pattern: /(?:https?:\/\/)?(?:\w+\.)*(?!(?:apple|google|microsoft|amazon|paypal|facebook|instagram)\.\w{2,4}$)[\w-]+\.(?:com|net|org|xyz|info|cc|tk|ml)\/\S*/i, weight: 5, name: 'Suspicious URL'},
  {pattern: /\b(reimbursed?\s*(?:on|after|with)\s*(?:first|your).*(?:paycheck|payment)|buy.*(?:kit|starter|package))\b/i, weight: 8, name: 'Pay-to-work scheme'},
  {pattern: /\b(download\s*(?:our|this)\s*(?:software|app|program|tool))\b/i, weight: 6, name: 'Suspicious software install'},
  {pattern: /\b(no\s*experience\s*(?:needed|required|necessary)|(?:full|free)\s*training\s*provided)\b/i, weight: 5, name: 'Too-good-to-be-true offer'},
  {pattern: /\b(send\s*(?:it|money|funds?)\s*(?:through|via|to)\s*(?:zelle|venmo|cashapp|western\s*union|bitcoin|crypto|wire))\b/i, weight: 9, name: 'Untraceable payment request'},
  {pattern: /\b(camera\s*(?:is\s*)?broken|can'?t\s*video\s*call|phone\s*(?:is\s*)?broken)\b/i, weight: 5, name: 'Avoids verification'},
  {pattern: /\b(you'?re\s*the\s*only\s*(?:person|one)\s*I\s*trust|I\s*(?:only|just)\s*trust\s*you)\b/i, weight: 5, name: 'Isolation/exclusive trust'},
  {pattern: /\b(\d{1,3}%\s*(?:roi|return|profit|growth|mom)|make\s*(?:that|it)\s*back|worth\s*\d+\s*figures?)\b/i, weight: 6, name: 'Unrealistic returns promised'},
];

// --- PERSUASION PATTERNS (CIALDINI + DARK PATTERNS) ---
const PERSUASION_PATTERNS = [
  {name:'Reciprocity Trigger',type:'CIALDINI PRINCIPLE',pattern:/\b(did.*for you|covered for you|helped you|remember when I|I gave you|favor.*return|I did this for)\b/i,desc:'By emphasizing past favors, the sender activates the reciprocity norm ‚Äî our deeply wired obligation to return favors.',severity:'high'},
  {name:'Artificial Scarcity / Urgency',type:'CIALDINI PRINCIPLE',pattern:/\b(limited.time|only \d|closes? (?:friday|today|tomorrow|soon)|expir(?:es?|ing)|(?:last|final) chance|running out|act (?:now|fast)|(?:don.t|do not) miss|hurry|ASAP|(?:hours?|days?) (?:left|remaining))\b/i,desc:'Scarcity makes things seem more valuable. Limited-time offers and "only X left" create urgency that bypasses deliberate analysis.',severity:'high'},
  {name:'Social Proof / Authority Drop',type:'CIALDINI PRINCIPLE',pattern:/\b(\d+ (?:companies|people|clients|users|customers)|well.known|industry leader|top.tier|backed by|as seen|featured|trusted by|recommended by|leadership.*mentioned)\b/i,desc:'Referencing numbers or authority figures triggers herd behavior ‚Äî "if others trust them, I should too."',severity:'medium'},
  {name:'Targeted Flattery / Liking',type:'CIALDINI PRINCIPLE',pattern:/\b(impressed|amazing|perfect for|you're (?:not like|special|exactly|the only)|been (?:watching|following)|your (?:background|profile|work).*impress)\b/i,desc:'Strategic compliments create positive association with the sender, increasing receptivity.',severity:'low'},
  {name:'Unity / In-Group Signaling',type:'CIALDINI PRINCIPLE',pattern:/\b(we're a family|part of (?:the|our) team|one of us|join (?:our|my|the) (?:team|family)|together|community|like-minded)\b/i,desc:'"We\'re a family" often means "we expect loyalty beyond contractual obligations."',severity:'medium'},
  {name:'Commitment Escalation',type:'DARK PATTERN',pattern:/\b(already (?:told|said|committed|signed|agreed)|you (?:said|agreed|committed)|since you already|too late to)\b/i,desc:'Leveraging your past micro-agreements to escalate commitment beyond original intent.',severity:'high'},
  {name:'False Choice / Anchoring',type:'DARK PATTERN',pattern:/\b(either.*or|(?:option|choice) [AB12]|would you (?:prefer|rather)|compared to|normally costs?|(?:regular|standard) (?:price|rate))\b/i,desc:'Presenting limited options or anchoring to a higher number to make the desired choice seem reasonable.',severity:'medium'},
  {name:'Emotional Blackmail',type:'MANIPULATION',pattern:/\b(if you (?:really|actually|truly) (?:loved|cared)|I guess.*not (?:important|enough)|you'll regret|when I'm gone|used to.*now you|disappointed|hurt (?:me|my feelings)|after everything|I always do|I'll manage)\b/i,desc:'Using guilt, fear, or obligation to coerce compliance. Emotional debts are not real debts.',severity:'high'},
  {name:'Gaslighting Signal',type:'MANIPULATION',pattern:/\b(you'?re (?:overreacting|too sensitive|imagining|being dramatic|crazy)|that never happened|I never said that|you always|you never)\b/i,desc:'Undermining your perception of reality to make you doubt your own judgment.',severity:'high'},
  {name:'Negging / Backhanded Compliment',type:'MANIPULATION',pattern:/\b(not (?:bad|like|as) (?:for|as)|you (?:could|should|would) (?:be|look)|for someone (?:like you|your age)|surprisingly|I'm just (?:being honest|saying))\b/i,desc:'A compliment designed to lower your self-esteem and increase your desire for the sender\'s approval.',severity:'medium'},
  {name:'Love Bombing',type:'MANIPULATION',pattern:/\b(soulmate|never felt this way|you're (?:the (?:best|one)|everything)|I (?:already|can't stop)|(?:deleted|leaving) the app|only.*talking to (?:you|one))\b/i,desc:'Overwhelming affection early on to create emotional dependency before revealing true intentions.',severity:'high'},
  {name:'Fear of Missing Out (FOMO)',type:'DARK PATTERN',pattern:/\b(everyone (?:is|else)|don't (?:be|get) left|you'll miss|won't get (?:another|this) chance|might lose|waiting list|people (?:who'd|would) love)\b/i,desc:'Triggering anxiety about missing an opportunity to force hasty decision-making.',severity:'medium'},
  {name:'Manufactured Intimacy',type:'MANIPULATION',pattern:/\b(just between (?:us|you and me)|I don't usually|you're special|I'm only telling you|can't share.*publicly|confidential)\b/i,desc:'Creating a false sense of exclusive closeness to bypass your rational filters.',severity:'medium'},
];

// --- BIAS PATTERNS ---
const BIAS_PATTERNS = [
  {name:'Survivorship Bias',type:'COGNITIVE BIAS',pattern:/\b(success stor(?:y|ies)|they made it|look at (?:them|him|her)|if they can.*you can|top \d+%|(?:most|many) people (?:make|earn))\b/i,desc:'Highlighting winners while hiding the far more common losers. Where are the failure stories?',severity:'medium'},
  {name:'Anchoring Effect',type:'COGNITIVE BIAS',pattern:/\b(\$[\d,]+.*\$[\d,]+|was \$.*now \$|(?:worth|valued at).*(?:only|just)\s*\$|regular(?:ly)?.*\$)\b/i,desc:'The first number you see becomes your reference point, making subsequent numbers feel like a deal.',severity:'medium'},
  {name:'Bandwagon / Herd Mentality',type:'COGNITIVE BIAS',pattern:/\b(everyone(?:'s| is)|most people|growing community|\d+\s*(?:members|users|clients|people)(?:\s*(?:and counting|strong))?|join \d+|trending)\b/i,desc:'Implying mass adoption to trigger conformity bias. Popular ‚â† good.',severity:'low'},
  {name:'Sunk Cost Exploitation',type:'COGNITIVE BIAS',pattern:/\b((?:you'?ve|we'?ve) (?:already|come this far)|invested (?:so much|all this)|too (?:far|much) to|don't waste|throwaway|give up now)\b/i,desc:'Exploiting your past investment to prevent you from making a rational exit decision now.',severity:'high'},
  {name:'Appeal to Authority (Unverifiable)',type:'COGNITIVE BIAS',pattern:/\b(studies show|research (?:proves|shows|suggests)|experts? (?:say|agree|recommend)|according to|scientifically (?:proven|backed))\b/i,desc:'Citing unnamed "experts" or "studies" without verifiable sources. Always ask: which study? Who funded it?',severity:'medium'},
];

// --- LOGICAL FALLACY PATTERNS ---
const LOGIC_PATTERNS = [
  {name:'False Dilemma',type:'LOGICAL FALLACY',pattern:/\b(either.*or|if you don'?t.*then|(?:only|two) (?:options?|choices?)|take it or leave|now or never|with us or against)\b/i,desc:'Presenting only two options when many exist. Real life rarely has binary choices.',severity:'high'},
  {name:'Slippery Slope',type:'LOGICAL FALLACY',pattern:/\b(will lead to|before you know it|soon (?:enough|you'll)|next thing|once.*starts?|if.*then.*then)\b/i,desc:'Claiming one action will inevitably lead to extreme consequences without logical connection.',severity:'medium'},
  {name:'Ad Hominem Redirect',type:'LOGICAL FALLACY',pattern:/\b(you (?:always|never)|(?:people|someone) like you|your (?:type|kind)|what do you know|you don't understand|typical)\b/i,desc:'Attacking the person instead of the argument to deflect from the actual issue.',severity:'medium'},
  {name:'Circular Reasoning',type:'LOGICAL FALLACY',pattern:/\b(because (?:I|we) said|it'?s (?:just|simply) (?:the way|how)|trust (?:me|us)|believe me|I know what I'm talking about)\b/i,desc:'The conclusion is assumed in the premise. "Trust me because I say so" is not reasoning.',severity:'medium'},
  {name:'Appeal to Emotion over Logic',type:'LOGICAL FALLACY',pattern:/\b(think (?:of|about) (?:the|your) (?:children|family|future)|how (?:would|could) you|imagine if|what if (?:something|it) happens?)\b/i,desc:'Substituting emotional reactions for logical arguments to bypass critical thinking.',severity:'low'},
];

// --- POWER DYNAMICS PATTERNS ---
const POWER_PATTERNS = [
  {name:'Implicit Threat',type:'POWER DYNAMIC',pattern:/\b(welcome to (?:find|leave|go)|if you (?:don't|have a problem)|waiting list|(?:others?|people) (?:who'd|would|who) (?:love|want)|consequence|regret|(?:I'll|we'll) (?:have to|assume))\b/i,desc:'Veiled threats disguised as "helpful information" ‚Äî designed to make you feel replaceable.',severity:'high'},
  {name:'Boundary Violation',type:'POWER DYNAMIC',pattern:/\b(I (?:have|got) a key|no need to be (?:home|present)|I'll (?:come|stop) by|without (?:your|prior) (?:consent|permission|notice)|inspect)\b/i,desc:'Casually overriding your right to consent. Legitimate actors ask; manipulators inform.',severity:'high'},
  {name:'Deadline Coercion',type:'POWER DYNAMIC',pattern:/\b((?:by|before) (?:EOD|eod|end of day|friday|tomorrow|tonight)|I'll assume|if I don't hear|silence (?:means|implies|will be))\b/i,desc:'Imposing artificial deadlines and treating silence as consent ‚Äî a power grab.',severity:'high'},
  {name:'Information Asymmetry',type:'POWER DYNAMIC',pattern:/\b(can't share.*details|more info (?:later|soon)|off the record|confidential|between us|I know things|insider)\b/i,desc:'Withholding key information while demanding decisions creates an unfair power advantage.',severity:'medium'},
  {name:'Financial Power Play',type:'POWER DYNAMIC',pattern:/\b((?:rent|price|rate|fee).*(?:going up|increas)|non.?negotiable|take it or leave|standard (?:terms|rate|practice)|market (?:rate|value))\b/i,desc:'Presenting one-sided terms as unchangeable facts to prevent negotiation.',severity:'medium'},
  {name:'IP / Rights Grab',type:'POWER DYNAMIC',pattern:/\b(all\s*intellectual\s*property|in\s*perpetuity|throughout\s*the\s*universe|waive.*(?:right|attribution)|moral\s*rights|assign\s*all|non.?compete.*(?:months?|years?))\b/i,desc:'Overly broad rights claims hidden in legalese. "In perpetuity throughout the universe" is not standard.',severity:'high'},
];

// --- EMOTIONAL MANIPULATION PATTERNS ---
const EMOTIONAL_PATTERNS = [
  {name:'Parentification / Role Reversal',type:'EMOTIONAL MANIPULATION',pattern:/\b((?:your|the) (?:father|mother) was (?:the same|like that)|just like your|you're (?:becoming|turning into)|apple.*tree|I raised you)\b/i,desc:'Forcing you into a caretaker role by making you responsible for the sender\'s emotional state.',severity:'high'},
  {name:'Passive-Aggressive Martyrdom',type:'EMOTIONAL MANIPULATION',pattern:/\b(it's fine|I'm (?:fine|used to it|okay)|don't worry about me|I'll (?:manage|survive|be fine)|(?:no|it's) (?:okay|alright)|I (?:guess|suppose).*(?:fine|okay))\b/i,desc:'Saying "I\'m fine" while clearly communicating the opposite to induce guilt without direct confrontation.',severity:'medium'},
  {name:'Catastrophizing',type:'EMOTIONAL MANIPULATION',pattern:/\b(when I'm gone|you'll regret|too late|one day you'll|never (?:forgive|forget)|the worst|everything is ruined|nothing (?:ever|will))\b/i,desc:'Escalating to worst-case scenarios to create panic and override rational thinking.',severity:'high'},
  {name:'Silent Treatment Setup',type:'EMOTIONAL MANIPULATION',pattern:/\b(I (?:won't|can't) (?:bother|disturb) you|if you (?:even|still) care|when you (?:have|find) time|maybe someday|I'll (?:stop|quit) (?:calling|texting|trying))\b/i,desc:'Pre-announcing withdrawal to create anxiety and force you to chase the sender.',severity:'medium'},
  {name:'Conditional Love Signal',type:'EMOTIONAL MANIPULATION',pattern:/\b(if you (?:really|truly|actually) (?:loved|cared|wanted)|prove (?:it|that you)|show me (?:that|you)|real (?:friend|partner) would)\b/i,desc:'Making love and approval contingent on compliance. Healthy relationships don\'t have conditions.',severity:'high'},
];


// --- CONTEXT AUTO-DETECTION ---
function detectContext(text) {
  const lower = text.toLowerCase();
  const scores = {business:0, personal:0, legal:0, dating:0, scam:0, media:0};

  // Scam signals
  if (/\b(dear beloved|million.*usd|processing fee|bank details|advance fee|widow|deceased|funds?\s*transfer)\b/i.test(text)) scores.scam += 10;
  if (/\b(verify.*account|click here|permanently.*locked|suspended|compromised|unusual.*sign.in)\b/i.test(text)) scores.scam += 8;
  if (/\b(send.*(?:zelle|venmo|western union|bitcoin|wire)|camera.*broken|can't video call)\b/i.test(text)) scores.scam += 7;
  if (/\b(no experience|reimbursed.*paycheck|purchase.*kit|download.*software)\b/i.test(text)) scores.scam += 7;
  if (/\b(lottery|winner|congratulations.*selected|inheritance|next of kin)\b/i.test(text)) scores.scam += 9;

  // Dating signals
  if (/\b(matched|dating|tinder|bumble|hinge|gorgeous|babe?y|soulmate|love you|miss you|deleted the app)\b/i.test(text)) scores.dating += 6;
  if (/üíò|üòç|ü•∫|üíï|‚ù§Ô∏è/.test(text)) scores.dating += 3;

  // Business signals
  if (/\b(ROI|cohort|onboard|enterprise|scaling|infrastructure|quarterly|KPI|pipeline|revenue)\b/i.test(text)) scores.business += 5;
  if (/\b(meeting|EOD|eod|deadline|deliverable|stakeholder|client)\b/i.test(text)) scores.business += 3;

  // Legal signals
  if (/\b(intellectual property|perpetuity|binding arbitration|non.compete|contractor|indemnif|jurisdiction|waive|herein|clause)\b/i.test(text)) scores.legal += 6;

  // Personal signals
  if (/\b(mom|dad|mother|father|family|brother|sister|remember when|I raised|when I'm gone)\b/i.test(text)) scores.personal += 5;
  if (/\b(guilt|sorry|disappoint|hurt|fine|manage|worry)\b/i.test(text)) scores.personal += 3;

  // Media
  if (/\b(sources say|according to|breaking|reported|allegedly|officials?)\b/i.test(text)) scores.media += 5;

  return Object.entries(scores).sort((a,b) => b[1] - a[1])[0][0];
}


// --- CORE ANALYSIS ---
function analyzePatterns(text, patterns) {
  const found = [];
  for (const p of patterns) {
    const match = text.match(p.pattern);
    if (match) {
      found.push({
        name: p.name,
        type: p.type,
        desc: p.desc,
        severity: p.severity,
        quote: extractQuote(text, match.index, match[0].length)
      });
    }
  }
  return found;
}

function analyzeScam(text) {
  let score = 0;
  const flags = [];
  for (const sp of SCAM_PATTERNS) {
    if (sp.pattern.test(text)) {
      score += sp.weight;
      flags.push(sp.name);
    }
  }
  return {score, flags, isScam: score >= 20, isLikelyScam: score >= 12};
}

function extractQuote(text, idx, matchLen) {
  const start = Math.max(0, text.lastIndexOf(' ', Math.max(0, idx - 40)));
  const end = Math.min(text.length, text.indexOf(' ', idx + matchLen + 40) || text.length);
  let q = text.substring(start, end).trim();
  if (start > 0) q = '...' + q;
  if (end < text.length) q = q + '...';
  return q;
}

// --- VERDICT DETERMINATION ---
function determineVerdict(scamResult, allFindings) {
  const highCount = allFindings.filter(f => f.severity === 'high').length;
  const totalCount = allFindings.length;

  if (scamResult.isScam) return {level:'scam', icon:'üö®', label:'Scam Detected', sub:'This message contains multiple indicators of fraud. Do not engage or share personal information.'};
  if (scamResult.isLikelyScam) return {level:'scam', icon:'‚ö†Ô∏è', label:'Likely Scam', sub:'Several fraud indicators found. Proceed with extreme caution ‚Äî verify sender independently.'};
  if (highCount >= 3) return {level:'manipulation', icon:'üî¥', label:'Heavy Manipulation', sub:'This message is loaded with influence tactics. Do not decide under its influence.'};
  if (highCount >= 1 || totalCount >= 4) return {level:'caution', icon:'üü°', label:'Manipulation Detected', sub:'Multiple influence tactics found. Read critically and take time before responding.'};
  if (totalCount >= 2) return {level:'caution', icon:'üü°', label:'Minor Influence Detected', sub:'A few persuasion signals found. Probably harmless, but stay aware.'};
  return {level:'clean', icon:'‚úÖ', label:'Appears Clean', sub:'No significant manipulation detected. Standard communication patterns.'};
}

// --- AGENDA INFERENCE ---
function inferAgenda(context, scamResult, allFindings) {
  if (scamResult.isScam || scamResult.isLikelyScam) {
    if (scamResult.flags.some(f => f.includes('banking') || f.includes('identity') || f.includes('Advance fee')))
      return {goal: 'Extract money or personal financial information from you', tactics: scamResult.flags};
    if (scamResult.flags.some(f => f.includes('Phishing') || f.includes('Suspicious URL')))
      return {goal: 'Steal your login credentials or install malware on your device', tactics: scamResult.flags};
    if (scamResult.flags.some(f => f.includes('Pay-to-work') || f.includes('Too-good-to-be-true')))
      return {goal: 'Get you to pay upfront for a job that doesn\'t exist', tactics: scamResult.flags};
    return {goal: 'Extract money, data, or access from you through deception', tactics: scamResult.flags};
  }

  const names = allFindings.map(f => f.name);
  const agendas = {
    dating: {
      goal: 'Fast-track emotional intimacy to bypass your judgment and boundaries',
      tactics: ['Love bombing', 'Isolation tactics', 'Urgency to move off-platform']
    },
    personal: {
      goal: 'Induce guilt to control your behavior without making a direct request',
      tactics: ['Emotional blackmail', 'Martyrdom', 'Obligation weaponization']
    },
    business: {
      goal: 'Pressure you into a quick "yes" before you can evaluate the actual value',
      tactics: ['Artificial urgency', 'Social proof', 'Reciprocity exploitation']
    },
    legal: {
      goal: 'Lock you into terms that heavily favor the other party with minimal negotiation',
      tactics: ['IP rights grab', 'Broad non-compete', 'Arbitration bias']
    },
    media: {
      goal: 'Shape your opinion through emotional framing rather than evidence',
      tactics: ['Emotional anchoring', 'Selective framing', 'Authority citation']
    }
  };

  if (names.some(n => n.includes('Love Bombing') || n.includes('Catfish'))) {
    return {goal: 'Build emotional dependency to eventually request money or personal info', tactics: ['Love bombing', 'Manufactured intimacy', 'Financial extraction']};
  }
  if (names.some(n => n.includes('Emotional Blackmail') || n.includes('Martyrdom'))) {
    return {goal: 'Make you feel guilty enough to comply without them having to ask directly', tactics: ['Guilt induction', 'Passive aggression', 'Conditional love']};
  }
  if (names.some(n => n.includes('Reciprocity') || n.includes('Commitment'))) {
    return {goal: 'Leverage social obligation to get you to agree to something you otherwise wouldn\'t', tactics: ['Reciprocity debt', 'Commitment escalation', 'Social pressure']};
  }

  return agendas[context] || {goal: 'Influence your decision through psychological pressure rather than merit', tactics: ['Persuasion tactics', 'Cognitive bias exploitation']};
}

// --- DECODED TRANSLATION ---
function buildTranslation(text, context, scamResult, allFindings) {
  const lower = text.toLowerCase();
  const lines = [];

  if (scamResult.isScam || scamResult.isLikelyScam) {
    lines.push('"I need access to your money or identity. The story is fabricated to create urgency and sympathy. There is no fund, no inheritance, no compromised account ‚Äî only a script designed to make you act before you think."');
    return lines.join('\n\n');
  }

  if (context === 'dating') {
    if (/deleted the app|only.*talking to/i.test(text)) lines.push('"I\'m creating artificial exclusivity to rush emotional intimacy. Healthy connections don\'t require declarations this early."');
    if (/camera.*broken|can't video/i.test(text)) lines.push('"I\'m avoiding visual verification because I\'m not who I claim to be."');
    if (/send.*money|zelle|venmo|\$\d/i.test(text)) lines.push('"The emotional buildup was the setup. This request for money is the actual goal."');
    if (/gorgeous|amazing|beautiful|not like other/i.test(text)) lines.push('"I\'m front-loading compliments to lower your guard and create reciprocity pressure."');
    if (lines.length === 0) lines.push('"I\'m using emotional intensity to bypass the slow trust-building that healthy relationships require."');
  }

  if (context === 'personal') {
    if (/when I'm gone|you'll regret/i.test(text)) lines.push('"I\'m using my mortality as emotional leverage to make you comply out of guilt and fear."');
    if (/your father|just like/i.test(text)) lines.push('"I\'m comparing you to someone you have complicated feelings about to trigger shame."');
    if (/I'm fine|I'll manage|don't worry/i.test(text)) lines.push('"I\'m saying \'I\'m fine\' to communicate the opposite. I want you to feel guilty without me having to make an explicit request."');
    if (/sat.*waiting|used to call/i.test(text)) lines.push('"I\'m weaponizing the past version of our relationship to make you feel inadequate in the present."');
    if (lines.length === 0) lines.push('"I\'m using emotional pressure instead of a direct conversation about what I actually need from you."');
  }

  if (context === 'business') {
    if (/covered for you|remember when/i.test(text)) lines.push('"I\'m calling in a favor debt to make it socially costly for you to say no."');
    if (/only person|only you can/i.test(text)) lines.push('"I\'m flattering you to make refusal feel like a personal failing rather than a reasonable boundary."');
    if (/already told|leadership.*mentioned/i.test(text)) lines.push('"I pre-committed you without your consent to make backing out feel like letting others down."');
    if (/ROI|247 companies|\d+%/i.test(text)) lines.push('"These numbers are designed to anchor your expectations. Ask: are they verifiable? Relevant to MY situation?"');
    if (/reserved a spot|closes friday/i.test(text)) lines.push('"The artificial deadline exists to prevent you from shopping around or thinking critically."');
    if (lines.length === 0) lines.push('"I\'m using a combination of urgency and social proof to bypass your normal evaluation process."');
  }

  if (context === 'legal') {
    lines.push('"The broad language is intentional ‚Äî \'in perpetuity throughout the universe\' isn\'t standard, it\'s a rights grab. Every expansive clause here favors one party. This needs negotiation, not signature."');
  }

  if (lines.length === 0) {
    const highFindings = allFindings.filter(f => f.severity === 'high');
    if (highFindings.length > 0) {
      lines.push(`"This message uses ${highFindings.length} high-severity influence tactic${highFindings.length > 1 ? 's' : ''} to pressure a specific outcome. The emotional framing exists to prevent rational evaluation."`);
    } else {
      lines.push('"Some persuasion signals detected, but this may be standard communication style rather than intentional manipulation."');
    }
  }

  return lines.join('\n\n');
}


// --- SCORE CALCULATION ---
function calcDangerScore(scamResult, findings) {
  if (scamResult.isScam) return Math.min(100, 70 + scamResult.score);
  if (scamResult.isLikelyScam) return Math.min(80, 50 + scamResult.score);

  let score = 0;
  for (const f of findings) {
    if (f.severity === 'high') score += 14;
    else if (f.severity === 'medium') score += 8;
    else score += 4;
  }
  return Math.min(100, Math.max(0, score));
}


// --- MAIN ANALYSIS ---
async function runAnalysis() {
  const text = document.getElementById('inputText').value.trim();
  if (!text) {
    document.getElementById('inputText').style.borderColor = 'var(--red)';
    setTimeout(() => document.getElementById('inputText').style.borderColor = '', 1500);
    return;
  }

  // Show overlay
  const overlay = document.getElementById('scanOverlay');
  overlay.classList.add('active');

  // Artificial delay for UX
  await sleep(1200 + Math.random() * 800);

  // Auto-detect context
  const context = detectContext(text);

  // Run all engines
  const scamResult = analyzeScam(text);
  const persuasion = analyzePatterns(text, PERSUASION_PATTERNS);
  const bias = analyzePatterns(text, BIAS_PATTERNS);
  const logic = analyzePatterns(text, LOGIC_PATTERNS);
  const emotional = analyzePatterns(text, EMOTIONAL_PATTERNS);
  const power = analyzePatterns(text, POWER_PATTERNS);

  const allFindings = [...persuasion, ...bias, ...logic, ...emotional, ...power];

  // Determine verdict
  const verdict = determineVerdict(scamResult, allFindings);

  // Infer agenda
  const agenda = inferAgenda(context, scamResult, allFindings);

  // Build translation
  const translation = buildTranslation(text, context, scamResult, allFindings);

  // Calculate danger score
  const dangerScore = calcDangerScore(scamResult, allFindings);

  // Hide overlay
  overlay.classList.remove('active');

  // Render
  renderVerdict(verdict);
  renderAgenda(agenda);
  renderMeaning(translation);
  renderScore(dangerScore, {persuasion: persuasion.length, bias: bias.length, logic: logic.length, emotional: emotional.length, power: power.length, scam: scamResult.flags.length});
  renderFindings({persuasion, bias, logic, emotional, power}, scamResult);

  // Show results
  const rs = document.getElementById('resultsSection');
  rs.classList.add('visible');
  rs.scrollIntoView({behavior:'smooth', block:'start'});
}


// --- RENDERERS ---
function renderVerdict(v) {
  const b = document.getElementById('verdictBanner');
  b.className = 'verdict-banner ' + v.level;
  document.getElementById('verdictIcon').textContent = v.icon;
  document.getElementById('verdictLabel').textContent = v.label;
  document.getElementById('verdictSub').textContent = v.sub;
}

function renderAgenda(a) {
  document.getElementById('agendaGoal').textContent = a.goal;
  const tc = document.getElementById('agendaTactics');
  tc.innerHTML = a.tactics.map(t => `<span class="agenda-tactic">${esc(t)}</span>`).join('');
}

function renderMeaning(text) {
  const el = document.getElementById('meaningText');
  el.textContent = '';
  // Typewriter effect
  let i = 0;
  const interval = setInterval(() => {
    if (i < text.length) {
      el.textContent += text[i];
      i++;
    } else {
      clearInterval(interval);
    }
  }, 12);
}

function renderScore(danger, counts) {
  // Animate ring
  const circumference = 2 * Math.PI * 14; // r=14
  const ring = document.getElementById('dangerRing');
  const offset = circumference - (danger / 100) * circumference;
  ring.style.stroke = danger >= 70 ? 'var(--red)' : danger >= 40 ? 'var(--orange)' : danger >= 20 ? 'var(--gold)' : 'var(--green)';
  setTimeout(() => { ring.style.strokeDashoffset = offset; }, 100);

  const numEl = document.getElementById('dangerNum');
  numEl.style.color = danger >= 70 ? 'var(--red)' : danger >= 40 ? 'var(--orange)' : danger >= 20 ? 'var(--gold)' : 'var(--green)';
  // Animate number
  let current = 0;
  const step = Math.ceil(danger / 30);
  const numInterval = setInterval(() => {
    current = Math.min(current + step, danger);
    numEl.textContent = current;
    if (current >= danger) clearInterval(numInterval);
  }, 30);

  // Sub scores
  const colors = {persuasion:'var(--orange)', bias:'var(--purple)', logic:'var(--cyan)', emotional:'var(--pink)', power:'var(--red)', scam:'var(--red-soft)'};
  const labels = {persuasion:'Persuasion', bias:'Bias', logic:'Logic', emotional:'Emotional', power:'Power', scam:'Fraud'};
  const ss = document.getElementById('subScores');
  ss.innerHTML = Object.entries(counts).filter(([k,v]) => v > 0).map(([k,v]) =>
    `<span class="sub-score"><span class="sub-dot" style="background:${colors[k]}"></span>${labels[k]} <strong>${v}</strong></span>`
  ).join('');
}

function renderFindings(categories, scamResult) {
  const tabsEl = document.getElementById('findingsTabs');
  const contentEl = document.getElementById('findingsContent');

  // Build tabs including scam if present
  const tabs = [];
  if (scamResult.flags.length > 0) tabs.push({key:'scam', label:'Fraud Signals', count: scamResult.flags.length, findings: scamResult.flags.map(f => ({name: f, type:'FRAUD INDICATOR', desc:'This message contains a known fraud/scam pattern.', severity:'high', quote:''}))});
  if (categories.persuasion.length) tabs.push({key:'persuasion', label:'Persuasion', count: categories.persuasion.length, findings: categories.persuasion});
  if (categories.emotional.length) tabs.push({key:'emotional', label:'Emotional', count: categories.emotional.length, findings: categories.emotional});
  if (categories.bias.length) tabs.push({key:'bias', label:'Bias', count: categories.bias.length, findings: categories.bias});
  if (categories.logic.length) tabs.push({key:'logic', label:'Logic', count: categories.logic.length, findings: categories.logic});
  if (categories.power.length) tabs.push({key:'power', label:'Power', count: categories.power.length, findings: categories.power});

  if (tabs.length === 0) {
    tabsEl.innerHTML = '';
    contentEl.innerHTML = '<p style="color:var(--gray);text-align:center;padding:20px;">No specific manipulation patterns detected.</p>';
    return;
  }

  tabsEl.innerHTML = tabs.map((t, i) =>
    `<div class="findings-tab${i===0?' active':''}" data-tab="${t.key}">${t.label}<span class="tab-count">${t.count}</span></div>`
  ).join('');

  // Render first tab content
  renderTabContent(tabs[0].findings);

  // Tab click handlers
  tabsEl.querySelectorAll('.findings-tab').forEach(tab => {
    tab.addEventListener('click', function() {
      tabsEl.querySelectorAll('.findings-tab').forEach(t => t.classList.remove('active'));
      this.classList.add('active');
      const key = this.dataset.tab;
      const found = tabs.find(t => t.key === key);
      if (found) renderTabContent(found.findings);
    });
  });
}

function renderTabContent(findings) {
  const el = document.getElementById('findingsContent');
  el.innerHTML = findings.map(f => `
    <div class="finding-card">
      <div class="finding-top">
        <div class="finding-name">${esc(f.name)}</div>
        <span class="finding-badge ${f.severity}">${f.severity}</span>
      </div>
      <div class="finding-type">${esc(f.type)}</div>
      <div class="finding-desc">${esc(f.desc)}</div>
      ${f.quote ? `<div class="finding-quote">${esc(f.quote)}</div>` : ''}
    </div>
  `).join('');
}


// --- COPY RESULTS ---
function copyResults() {
  const verdict = document.getElementById('verdictLabel').textContent;
  const agenda = document.getElementById('agendaGoal').textContent;
  const meaning = document.getElementById('meaningText').textContent;
  const danger = document.getElementById('dangerNum').textContent;

  const text = `üîç THE HUMAN FILTER ‚Äî Analysis\n\n` +
    `VERDICT: ${verdict}\n` +
    `DANGER LEVEL: ${danger}/100\n\n` +
    `LIKELY AGENDA:\n${agenda}\n\n` +
    `WHAT THEY'RE ACTUALLY SAYING:\n${meaning}\n\n` +
    `Analyzed by The Human Filter ‚Äî humanlayerai.com`;

  navigator.clipboard.writeText(text).then(() => {
    const btn = document.querySelector('.copy-btn');
    btn.textContent = '‚úì Copied!';
    setTimeout(() => { btn.innerHTML = 'üìã Copy Full Analysis'; }, 2000);
  });
}


// --- PRESET & DEMO LOADING ---
document.querySelectorAll('.preset-chip').forEach(chip => {
  chip.addEventListener('click', function() {
    const key = this.dataset.preset;
    if (PRESETS[key]) {
      document.getElementById('inputText').value = PRESETS[key];
      updateCharCount();
      document.getElementById('inputText').scrollIntoView({behavior:'smooth', block:'center'});
    }
  });
});

document.querySelectorAll('.try-chip').forEach(chip => {
  chip.addEventListener('click', function() {
    const key = this.dataset.demo;
    if (PRESETS[key]) {
      document.getElementById('inputText').value = PRESETS[key];
      updateCharCount();
    }
  });
});


// --- CHAR COUNT ---
function updateCharCount() {
  const len = document.getElementById('inputText').value.length;
  document.getElementById('charCount').textContent = len + ' chars';
}
document.getElementById('inputText').addEventListener('input', updateCharCount);


// --- UTILS ---
function esc(s) { return s ? s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;') : ''; }
function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }
</script>
</body>
</html>
